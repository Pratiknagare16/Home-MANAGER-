{% extends "base.html" %}
{% block title %}Home Manager{% endblock %}
{% block body_class %}app-body{% if request.endpoint %} has-bottom-nav{% endif %}{% endblock %}

{% block navbar %}{% endblock %}

{% block content %}
<div class="app-wrapper">
    <!-- Sidebar -->
    <aside class="sidebar" id="appSidebar">
        <div class="sidebar-header">
            <a href="{{ url_for('dashboard.dashboard') }}" class="sidebar-brand text-decoration-none">
                <i class="fa-solid fa-house-chimney text-primary fs-4 me-2"></i>
                <span class="fw-bold fs-5 text-dark">Home Manager</span>
            </a>
        </div>
        
        <nav class="sidebar-nav">
            <ul class="nav flex-column gap-2">
                <li class="nav-item">
                    <a href="{{ url_for('dashboard.dashboard') }}" class="nav-link {% if request.endpoint == 'dashboard.dashboard' %}active{% endif %}">
                        <i class="fa-solid fa-chart-line nav-icon"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="{{ url_for('expenses.list_expenses') }}" class="nav-link {% if request.endpoint and request.endpoint.startswith('expenses.') %}active{% endif %}">
                        <i class="fa-solid fa-wallet nav-icon"></i>
                        <span>Expenses</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="{{ url_for('tasks.list_tasks') }}" class="nav-link {% if request.endpoint and request.endpoint.startswith('tasks.') %}active{% endif %}">
                        <i class="fa-solid fa-check-circle nav-icon"></i>
                        <span>Tasks</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="{{ url_for('notes.list_notes') }}" class="nav-link {% if request.endpoint and request.endpoint.startswith('notes.') %}active{% endif %}">
                        <i class="fa-solid fa-sticky-note nav-icon"></i>
                        <span>Notes</span>
                    </a>
                </li>
                {% if current_user.home_id %}
                <li class="nav-item mt-3">
                    <div class="text-muted small text-uppercase fw-bold px-3 mb-2">My Home</div>
                    <a href="{{ url_for('homes.view') }}" class="nav-link {% if request.endpoint and request.endpoint.startswith('homes.') %}active{% endif %}">
                        <i class="fa-solid fa-users nav-icon"></i>
                        <span>{{ current_user.home.home_name }}</span>
                    </a>
                </li>
                {% endif %}
            </ul>
        </nav>
        
        <div class="sidebar-footer">
            <div class="user-profile d-flex align-items-center gap-3 p-2 rounded-3">
                <div class="avatar-circle bg-primary text-white d-flex align-items-center justify-content-center fw-bold rounded-circle" style="width: 40px; height: 40px;">
                    {{ current_user.display_name[0] | upper }}
                </div>
                <div class="user-info overflow-hidden">
                    <div class="user-name fw-semibold text-truncate">{{ current_user.display_name }}</div>
                    <div class="user-role text-muted small">{{ current_user.role|capitalize }}</div>
                </div>
                <a href="{{ url_for('auth.logout') }}" class="logout-btn ms-auto text-muted hover-danger" title="Logout">
                    <i class="fa-solid fa-arrow-right-from-bracket"></i>
                </a>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Header -->
        <header class="top-header d-flex align-items-center justify-content-between px-4 py-3 bg-white border-bottom">
            <div class="d-flex align-items-center gap-3">
                <button class="btn btn-link d-lg-none text-dark p-0" id="sidebarToggle">
                    <i class="fa-solid fa-bars fs-5"></i>
                </button>
                
                <div class="header-search position-relative d-none d-md-block">
                    <i class="fa-solid fa-search text-muted position-absolute top-50 start-0 translate-middle-y ms-3"></i>
                    <input type="text" class="form-control border-0 bg-light ps-5 rounded-pill" placeholder="Search..." style="width: 250px;">
                </div>
            </div>
            
            <div class="header-actions d-flex align-items-center gap-3">
                <button class="btn btn-icon position-relative text-secondary">
                    <i class="fa-regular fa-bell fs-5"></i>
                    <span class="position-absolute top-0 start-100 translate-middle p-1 bg-danger border border-light rounded-circle">
                        <span class="visually-hidden">New alerts</span>
                    </span>
                </button>
                <div class="d-lg-none avatar-circle bg-primary text-white d-flex align-items-center justify-content-center fw-bold rounded-circle" style="width: 32px; height: 32px;">
                     {{ current_user.display_name[0] | upper }}
                </div>
            </div>
        </header>

        <main class="content-body p-4">
            {% block app_content %}{% endblock %}
        </main>
    </div>
</div>

<!-- Quick Add Modal -->
<div class="modal fade" id="quickAddModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header border-bottom-0 pb-0">
                <h5 class="modal-title fw-bold">Quick Add</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <ul class="nav nav-tabs nav-fill mb-4" id="quickAddTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active fw-semibold" id="expense-tab" data-bs-toggle="tab" data-bs-target="#expense-pane" type="button" role="tab">Expense</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link fw-semibold" id="task-tab" data-bs-toggle="tab" data-bs-target="#task-pane" type="button" role="tab">Task</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link fw-semibold" id="note-tab" data-bs-toggle="tab" data-bs-target="#note-pane" type="button" role="tab">Note</button>
                    </li>
                </ul>
                
                <div class="tab-content" id="quickAddTabContent">
                    <!-- Expense Form -->
                    <div class="tab-pane fade show active" id="expense-pane" role="tabpanel">
                        <form action="{{ url_for('expenses.list_expenses') }}" method="POST">
                            <div class="mb-3">
                                <label class="form-label text-muted small fw-bold text-uppercase">Title</label>
                                <input type="text" class="form-control bg-light border-0" name="title" placeholder="What did you buy?" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-muted small fw-bold text-uppercase">Amount</label>
                                <div class="input-group">
                                    <span class="input-group-text bg-light border-0">â‚¹</span>
                                    <input type="number" step="0.01" class="form-control bg-light border-0" name="amount" placeholder="0.00" required>
                                </div>
                            </div>
                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary">Add Expense</button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Task Form -->
                    <div class="tab-pane fade" id="task-pane" role="tabpanel">
                        <form action="{{ url_for('tasks.list_tasks') }}" method="POST">
                            <div class="mb-3">
                                <label class="form-label text-muted small fw-bold text-uppercase">Task</label>
                                <input type="text" class="form-control bg-light border-0" name="task" placeholder="What needs to be done?" required>
                            </div>
                            <div class="d-grid">
                                <button type="submit" class="btn btn-success">Add Task</button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Note Form -->
                    <div class="tab-pane fade" id="note-pane" role="tabpanel">
                        <form action="{{ url_for('notes.list_notes') }}" method="POST">
                            <div class="mb-3">
                                <label class="form-label text-muted small fw-bold text-uppercase">Title</label>
                                <input type="text" class="form-control bg-light border-0" name="title" placeholder="Note title" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-muted small fw-bold text-uppercase">Content</label>
                                <textarea class="form-control bg-light border-0" name="content" rows="3" placeholder="Write something..."></textarea>
                            </div>
                            <div class="d-grid">
                                <button type="submit" class="btn btn-warning text-white">Add Note</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Mobile Bottom Nav -->
<nav class="mobile-bottom-nav d-lg-none fixed-bottom bg-white border-top d-flex justify-content-around align-items-center py-2 safe-area-bottom">
    <a href="{{ url_for('dashboard.dashboard') }}" class="nav-item text-decoration-none text-center {% if request.endpoint == 'dashboard.dashboard' %}active text-primary{% else %}text-secondary{% endif %}">
        <i class="fa-solid fa-chart-line fs-5 mb-1 d-block"></i>
        <span class="small">Dash</span>
    </a>
    <a href="{{ url_for('expenses.list_expenses') }}" class="nav-item text-decoration-none text-center {% if request.endpoint and request.endpoint.startswith('expenses.') %}active text-primary{% else %}text-secondary{% endif %}">
        <i class="fa-solid fa-wallet fs-5 mb-1 d-block"></i>
        <span class="small">Exp</span>
    </a>
    <div class="nav-item-add" style="margin-top: -25px;">
        <button class="btn btn-primary rounded-circle shadow d-flex align-items-center justify-content-center" style="width: 48px; height: 48px;" data-bs-toggle="modal" data-bs-target="#quickAddModal">
            <i class="fa-solid fa-plus fs-4"></i>
        </button>
    </div>
    <a href="{{ url_for('tasks.list_tasks') }}" class="nav-item text-decoration-none text-center {% if request.endpoint and request.endpoint.startswith('tasks.') %}active text-primary{% else %}text-secondary{% endif %}">
        <i class="fa-solid fa-check-circle fs-5 mb-1 d-block"></i>
        <span class="small">Task</span>
    </a>
    <a href="{{ url_for('notes.list_notes') }}" class="nav-item text-decoration-none text-center {% if request.endpoint and request.endpoint.startswith('notes.') %}active text-primary{% else %}text-secondary{% endif %}">
        <i class="fa-solid fa-sticky-note fs-5 mb-1 d-block"></i>
        <span class="small">Note</span>
    </a>
</nav>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const toggle = document.getElementById('sidebarToggle');
  const sidebar = document.getElementById('appSidebar');
  
  if (toggle && sidebar) {
    toggle.addEventListener('click', function(e) {
      e.stopPropagation();
      sidebar.classList.toggle('show');
      
      // Manage overlay
      let overlay = document.querySelector('.sidebar-overlay');
      if (sidebar.classList.contains('show')) {
          if (!overlay) {
              overlay = document.createElement('div');
              overlay.className = 'sidebar-overlay';
              document.body.appendChild(overlay);
              overlay.addEventListener('click', () => {
                  sidebar.classList.remove('show');
                  overlay.remove();
              });
          }
      } else if (overlay) {
          overlay.remove();
      }
    });
  }
});
</script>
{% endblock %}

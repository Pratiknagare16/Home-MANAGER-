{% extends "base_app.html" %}
{% block title %}Expenses – Home Manager{% endblock %}
{% block app_content %}
<header class="page-header d-flex flex-wrap align-items-center justify-content-between gap-3 mb-4">
  <h1 class="page-title mb-0">Expenses</h1>
  {% if can_edit %}
  <div class="expense-toolbar">
    <a href="{{ url_for('expenses.list_expenses') }}#add" class="btn btn-primary btn-add-pulse" id="add">+ Add expense</a>
  </div>
  {% endif %}
</header>

{% if can_edit %}
<div class="expense-form-card" id="add">
  <h5 class="mb-4 fw-semibold">Add expense</h5>
  <form method="POST" action="{{ url_for('expenses.list_expenses') }}">
    <div class="row g-3 align-items-end">
      <div class="col-md-4">
        <label class="form-label">Name</label>
        <input type="text" class="form-control" name="title" placeholder="Expense name" required>
      </div>
      <div class="col-md-2">
        <label class="form-label">Amount (₹)</label>
        <input type="number" class="form-control" name="amount" step="0.01" min="0" required>
      </div>
      <div class="col-md-2">
        <label class="form-label">Category</label>
        <select class="form-select" name="category_id">
          <option value="">—</option>
          {% for c in categories %}<option value="{{ c.id }}">{{ c.name }}</option>{% endfor %}
        </select>
      </div>
      <div class="col-md-2">
        <label class="form-label">Payment</label>
        <select class="form-select" name="payment_method">
          <option value="cash">Cash</option>
          <option value="upi">UPI</option>
          <option value="card">Card</option>
          <option value="other">Other</option>
        </select>
      </div>
      <div class="col-md-2">
        <button type="submit" class="btn btn-primary w-100">Add</button>
      </div>
    </div>
  </form>
</div>
{% endif %}

<div class="card border-0">
  <div class="card-header d-flex justify-content-between align-items-center">
    <span class="fw-semibold">All expenses</span>
    <strong class="expense-amount">Total: ₹{{ "%.2f"|format(total) }}</strong>
  </div>
  <ul class="list-group list-group-flush expense-list">
    {% for e in expenses %}
    <li class="list-group-item d-flex justify-content-between align-items-center expense-row" data-expense-id="{{ e.id }}">
      <span>
        <span class="fw-medium">{{ e.title }}</span>
        {% if e.category %}<span class="badge bg-light text-dark ms-2">{{ e.category.name }}</span>{% endif %}
        {% if e.payment_method %}<span class="badge bg-secondary ms-1">{{ e.payment_method }}</span>{% endif %}
        {% if e.date %}<span class="expense-date ms-2">{{ e.date.strftime('%d %b') if e.date else '' }}</span>{% endif %}
      </span>
      <span class="d-flex align-items-center gap-2">
        <span class="expense-amount">₹{{ "%.2f"|format(e.amount) }}</span>
        {% if can_edit %}
        <span class="expense-actions">
          <form method="POST" action="{{ url_for('expenses.delete_expense', expense_id=e.id) }}" class="d-inline expense-delete-form">
            <button type="submit" class="btn btn-sm btn-outline-danger">Remove</button>
          </form>
        </span>
        {% endif %}
      </span>
    </li>
    {% else %}
    <li class="list-group-item text-muted empty-state py-5 text-center">No expenses yet.{% if can_edit %} Add one above.{% endif %}</li>
    {% endfor %}
  </ul>
</div>
{% endblock %}
